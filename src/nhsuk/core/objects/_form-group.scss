@use "../settings" as *;
@use "../tools" as *;

@include nhsuk-exports("nhsuk/core/objects/form-group") {
  .nhsuk-form-group {
    @include nhsuk-clearfix;
    @include nhsuk-responsive-margin(5, "bottom");

    .nhsuk-form-group:last-child {
      margin-bottom: 0; // Remove margin from last item in nested groups
    }

    @include nhsuk-media-query($until: tablet) {
      // Add margin to button when in the same group as other form elements
      .nhsuk-button:not(:first-child),
      .nhsuk-button:not(:only-child) {
        margin-top: nhsuk-spacing(2);
      }

      // Remove margin from button when last, but reserve space for button shadow
      .nhsuk-button:last-child {
        margin-bottom: $nhsuk-button-shadow-size + $nhsuk-border-width-form-element;
      }
    }
  }

  .nhsuk-form-group--error {
    padding-left: nhsuk-spacing(3);
    border-left: $nhsuk-border-width-form-group-error solid $nhsuk-error-colour;

    .nhsuk-form-group {
      padding: 0;
      // Reset error styles in nested form groups that might have error class
      border: 0;
    }
  }

  .nhsuk-form-group--inline {
    display: block;

    .nhsuk-form-group {
      // Set max-width to override potential width override class on the input
      max-width: 100%;
      margin-bottom: nhsuk-spacing(2);
    }

    @include nhsuk-media-query($until: tablet) {
      // Unlike GOV.UK Frontend, always stack on small screens
      // stylelint-disable-next-line declaration-no-important
      display: block !important;
    }

    @include nhsuk-media-query($from: tablet) {
      display: flex;
      gap: nhsuk-spacing(2);
      align-items: flex-end;

      .nhsuk-form-group {
        flex-grow: 1;
        margin-bottom: 0; // Remove margin when nested groups are inline
      }

      .nhsuk-button,
      .nhsuk-button-group {
        flex-grow: 0;
      }

      // Remove inline button margin but reserve space for button shadow,
      // making sure 44px box maintains alignment with other form controls
      // https://nhsuk.github.io/nhsuk-frontend/examples/form-alignment/
      .nhsuk-button {
        margin-bottom: $nhsuk-button-shadow-size + $nhsuk-border-width-form-element;
      }
    }
  }
}
