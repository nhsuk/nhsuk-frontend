{% from "nhsuk/macros/attributes.njk" import nhsukAttributes %}
{% from "nhsuk/macros/icon.njk" import nhsukIcon %}

{% set blockLevel = not params.items and (params.next or params.previous) -%}

{%- macro _arrowLink(link, type = "next") %}
  {% set arrowType = nhsukIcon("arrow-left") if type == "prev" else nhsukIcon("arrow-right") %}
  <div class="nhsuk-pagination__{{ type }}">
    <a class="nhsuk-link nhsuk-pagination__link" href="{{ link.href }}" rel="{{ type }}"
      {{- nhsukAttributes(link.attributes) }}>
      {% if blockLevel or type == "prev" %}
        {{- arrowType | safe | indent(4, true) }}
      {% endif %}
      <span class="nhsuk-pagination__link-title {%- if blockLevel and not link.labelText %} nhsuk-pagination__link-title--decorated{% endif %}">
        {{ caller() | safe | trim }}
      </span>
      {% if link.labelText and blockLevel %}
      <span class="nhsuk-u-visually-hidden">:</span>
      <span class="nhsuk-pagination__link-label">{{ link.labelText }}</span>
      {% endif %}
      {% if not blockLevel and type == "next" %}
        {{- arrowType | safe | indent(4, true) }}
      {% endif %}
    </a>
  </div>
{% endmacro -%}

{%- macro _pageItem(item) -%}
  <li class="nhsuk-pagination__item {%- if item.current %} nhsuk-pagination__item--current{% endif %} {%- if item.ellipsis %} nhsuk-pagination__item--ellipsis{% endif %} {%- if item.classes %} {{ item.classes }}{% endif %}">
  {% if item.ellipsis %}
    &ctdot;
  {% else %}
    <a class="nhsuk-link nhsuk-pagination__link" href="{{ item.href }}" aria-label="{{ item.visuallyHiddenText | default("Page " ~ item.number) }}"
      {%- if item.current %} aria-current="page"{% endif %}
      {{- nhsukAttributes(item.attributes) }}>
      {{ item.number }}
    </a>
  {% endif %}
  </li>
{%- endmacro -%}

<nav {%- if params.id %} id="{{ params.id }}"{% endif %} class="nhsuk-pagination {%- if blockLevel %} nhsuk-pagination--block{% endif %} {%- if params.classes %} {{ params.classes }}{% endif %}" aria-label="{{ params.landmarkLabel | default("Pagination", true) }}"
  {{- nhsukAttributes(params.attributes) }}>
  {% set previous = params.previous %}
  {% set next = params.next %}

  {%- if previous and previous.href %}
    {% call _arrowLink(previous, "prev") %}
      {% if previous.html or previous.text %}
        {{ previous.html | safe | trim | indent(8) if previous.html else previous.text }}
      {% else %}
        Previous<span class="nhsuk-u-visually-hidden"> page</span>
      {% endif %}
    {% endcall %}
  {%- endif %}

  {%- if params.items | length %}
  <ul class="nhsuk-pagination__list">
  {% for item in params.items %}
    {% if item is not null and (item | length) > 0 %}
      {{ _pageItem(item) | indent(2) }}
    {% endif %}
  {% endfor %}
  </ul>
  {% endif %}

  {%- if next and next.href %}
    {% call _arrowLink(next, "next") %}
      {% if next.html or next.text %}
        {{ next.html | safe | trim | indent(8) if next.html else next.text }}
      {% else %}
        Next<span class="nhsuk-u-visually-hidden"> page</span>
      {% endif %}
    {% endcall %}
  {% endif %}
</nav>
